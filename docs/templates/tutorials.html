<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<link href="css/tutorials.css" rel="stylesheet">

<h1 id="nav-title">Tutorials</h1>
<div id="content" class="no-search">
  <!-- extra bottom padding to make end of files easier to read -->
  <div id="tutorial-markdown-display" style="padding-bottom: 25px;"></div>
</div>

<script>
  const markdownDisplay = document.getElementById("tutorial-markdown-display");
  let lastTutorialElement = null;
  async function updateTutorial() {
    const updateHighlighting = document.readyState === "complete";
    let tutorial = window.location.hash;
    if (tutorial === "") { /* fallback to welcome page */
      tutorial = "#welcome";
    }

    /* fetch new tutorial */
    let response = await fetch(`tutorials/${tutorial.substring(1)}.md`);
    if (!response.ok) { /* fallback to welcome page */
      response = await fetch("tutorials/welcome.md");
    }

    /* update active item */
    if (lastTutorialElement != null) {
      lastTutorialElement.classList.remove("active-item");
    }
    lastTutorialElement = document.querySelector(`#nav-contents a[href="${tutorial}"]`);
    if (lastTutorialElement != null) {
      lastTutorialElement.classList.add("active-item");
    }

    /* apply markdown */
    markdownDisplay.innerHTML = marked.parse(await response.text());
    markdownDisplay.querySelectorAll("pre").forEach((e) => {
      if (e.querySelector("code")) { /* ensure we have a code block */
        /* manually apply code box styling */
        e.classList.add("box", "code");
        e.style.setProperty("overflow", "auto");
      }
    });

    /*
     * only fire this event if we are switching the selected tutorial
     * right now, this event is currently only used to process code highlighting
     */
    if (updateHighlighting) {
      document.dispatchEvent(new Event("UpdateCodeHighlighting"))
    }
  }

  updateTutorial();
  window.onhashchange = function() { updateTutorial() };
</script>
